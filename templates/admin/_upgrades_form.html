<!-- templates/admin/_upgrades_form.html -->
<form onsubmit="event.preventDefault(); Upgrades.submit(this);" class="space-y-3">
  <input type="hidden" name="id" value="{{ upgrade.id if upgrade else '' }}">

  <!-- Existing DB field: what ultimately gets saved -->
  <input
    type="hidden"
    name="image_url"
    value="{{ upgrade.image_url if upgrade else '' }}"
    data-upgrade-image-url
  />

  <!-- Temp upload key (server returns this from /admin/upgrades/ajax/upload-image) -->
  <input
    type="hidden"
    name="image_tmp_key"
    value=""
    data-upgrade-image-tmp-key
  />

  <!-- Property -->
  <div>
    <label class="text-xs font-semibold text-slate-600">Property</label>
    <select
      name="property_id"
      required
      class="mt-1 h-10 w-full px-3 rounded-xl border border-slate-200 text-sm bg-white"
    >
      {% for p in properties %}
        <option value="{{ p.id }}" {% if upgrade and upgrade.property_id == p.id %}selected{% endif %}>
          {{ p.property_name }}
        </option>
      {% endfor %}
    </select>
  </div>

  <!-- Slug -->
  <div>
    <label class="text-xs font-semibold text-slate-600">Slug</label>
    <input
      name="slug"
      required
      value="{{ upgrade.slug if upgrade else '' }}"
      class="mt-1 h-10 w-full px-3 rounded-xl border border-slate-200 text-sm"
    />
    <div class="text-xs text-slate-500 mt-1">
      URL-safe (e.g. <code>early-check-in</code>)
    </div>
  </div>

  <!-- Title -->
  <div>
    <label class="text-xs font-semibold text-slate-600">Title</label>
    <input
      name="title"
      required
      value="{{ upgrade.title if upgrade else '' }}"
      class="mt-1 h-10 w-full px-3 rounded-xl border border-slate-200 text-sm"
    />
  </div>

  <!-- Long description -->
  <div>
    <label class="text-xs font-semibold text-slate-600">Long description</label>
    <textarea
      name="long_description"
      rows="5"
      placeholder="Describe what the guest gets, any rules, timing, how to request it, etc."
      class="mt-1 w-full px-3 py-2 rounded-xl border border-slate-200 text-sm bg-white resize-y"
    >{{ upgrade.long_description if (upgrade and upgrade.long_description) else '' }}</textarea>
    <div class="mt-1 text-xs text-slate-500">Shown in the guest UI / upsell details.</div>
  </div>

  <!-- Image upload -->
  <div>
    <label class="text-xs font-semibold text-slate-600">Image</label>

    <div class="mt-2 flex items-center gap-2 flex-wrap">
      <label
        class="h-10 px-4 rounded-xl bg-white border border-slate-200 hover:bg-slate-50 text-sm font-semibold grid place-items-center cursor-pointer"
      >
        Choose image
        <input type="file" accept="image/*" class="hidden" data-upgrade-image-file />
      </label>

      <button
        type="button"
        class="h-10 px-4 rounded-xl bg-slate-900 hover:bg-slate-800 text-white text-sm font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
        data-upgrade-image-upload
      >
        Upload
      </button>

      <button
        type="button"
        class="h-10 px-4 rounded-xl border border-slate-200 bg-white hover:bg-slate-50 text-sm font-semibold"
        data-upgrade-image-clear
      >
        Remove
      </button>

      <div class="text-xs text-slate-500">PNG/JPG/WebP recommended.</div>
    </div>

    <!-- Preview -->
    <img
      data-upgrade-image-preview
      src="{{ upgrade.image_url if (upgrade and upgrade.image_url) else '' }}"
      alt="Upgrade image"
      class="mt-2 w-full rounded-xl border border-slate-200 object-cover {% if not (upgrade and upgrade.image_url) %}hidden{% endif %}"
      style="max-height:180px;"
    />

    <div class="mt-1 text-xs text-slate-500">Used in guest UI / upsell cards.</div>
  </div>

  <!-- Price -->
  <div>
    <label class="text-xs font-semibold text-slate-600">Price (USD)</label>
    <input
      name="price_dollars"
      type="number"
      min="0"
      step="0.01"
      value="{{ '%.2f'|format((upgrade.price_cents or 0) / 100) if upgrade else '0.00' }}"
      class="mt-1 h-10 w-full px-3 rounded-xl border border-slate-200 text-sm"
    />
  </div>

  <!-- Active -->
  <div class="flex items-center gap-2">
    <input
      type="checkbox"
      name="is_active"
      value="true"
      class="h-4 w-4"
      {% if upgrade and upgrade.is_active %}checked{% endif %}
    />
    <span class="text-sm">Active</span>
  </div>

  <!-- Actions -->
  <div class="flex justify-end gap-2 pt-2">
    <button
      type="button"
      onclick="Upgrades.closeEditor()"
      class="h-9 px-3 rounded-xl border border-slate-200 bg-white text-sm"
    >
      Cancel
    </button>

    <button
      type="submit"
      class="h-9 px-4 rounded-xl bg-slate-900 hover:bg-slate-800 text-white text-sm font-semibold"
    >
      Save Upgrade
    </button>
  </div>
</form>
