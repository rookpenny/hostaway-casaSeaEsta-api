<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Choose your properties</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-50 text-slate-900">
  <div class="min-h-screen">

    <!-- Header -->
    <header class="border-b border-slate-200 bg-white/80 backdrop-blur">
      <div class="max-w-3xl mx-auto px-6 h-16 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-xl bg-slate-900 text-white grid place-items-center font-semibold">HS<sup>AI</sup></div>
          <div>
            <div class="text-sm font-semibold leading-4">HostScout</div>
            <div class="text-xs text-slate-500">Onboarding</div>
          </div>
        </div>

        <a href="/admin/dashboard" class="text-sm font-semibold text-slate-700 hover:underline">
          Skip for now →
        </a>
      </div>
    </header>


    <main class="max-w-3xl mx-auto px-6 py-10 space-y-6">

      <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm">



        <!-- Progress indicator -->
        <div class="flex items-center justify-between gap-4">
          <div>
            <div class=text-xs font-semibold text-slate-500 uppercase tracking-wide">Step 3 of 4</div>
            <div class="mt-1 h-2 w-44 rounded-full bg-slate-100 overflow-hidden">
              <div class="h-2 w-3/4 bg-slate-900 rounded-full"></div>
            </div>
          </div>
          <div class="text-xs text-slate-500">
            Create → Integrate PMS → <span class="font-semibold text-slate-700">Configure properties</span> → Review & activate
          </div>
        </div>
              
        <h1 class="mt-5 text-2xl font-semibold">Choose properties to activate</h1>
        <p class="mt-2 text-sm text-slate-600">
          Select the properties you want enabled. You can change this later in your dashboard.
        </p>

        <!-- Empty state -->
        {% if not properties or properties|length == 0 %}
          <div class="mt-6 rounded-xl border border-amber-200 bg-amber-50 p-4">
            <div class="text-sm font-semibold text-amber-900">No properties found</div>
            <p class="mt-1 text-sm text-amber-900/80">
              We didn’t find any imported properties for your account yet.
              Go back and re-run the import from your PMS connection step.
            </p>
            <div class="mt-3">
              <a href="/pmc/onboarding/pms"
                 class="inline-flex h-10 items-center px-4 rounded-xl bg-slate-900 hover:bg-slate-800 text-white text-sm font-semibold">
                Back to Connect PMS →
              </a>
            </div>
          </div>
        {% else %}

        <!-- Pricing summary -->
        <div class="mt-6 rounded-xl border border-slate-200 bg-slate-50 p-4">
          <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
            <div>
              <div class="text-sm font-semibold text-slate-900">Pricing</div>
              <p class="mt-1 text-sm text-slate-600">
                <span class="font-semibold">$9.99 / month</span> per active property
                + <span class="font-semibold">$499 one-time setup</span> (charged at checkout).
              </p>
              <p class="mt-2 text-[12px] text-slate-500">
                You won’t be charged yet — next step is a review screen before Stripe checkout.
              </p>
            </div>

            <div class="w-full sm:w-64 rounded-xl border border-slate-200 bg-white p-4">
              <div class="flex items-center justify-between text-sm">
                <span class="text-slate-600">Active properties</span>
                <span id="selected-count" class="font-semibold text-slate-900">0</span>
              </div>
              <div class="mt-2 flex items-center justify-between text-sm">
                <span class="text-slate-600">$9.99 × count</span>
                <span id="monthly-total" class="font-semibold text-slate-900">$0.00/mo</span>
              </div>
              <div class="mt-2 flex items-center justify-between text-sm">
                <span class="text-slate-600">One-time setup</span>
                <span class="font-semibold text-slate-900">$499.00</span>
              </div>
              <div class="mt-3 pt-3 border-t border-slate-200 flex items-center justify-between text-sm">
                <span class="text-slate-600">Due at checkout</span>
                <span id="due-today" class="font-semibold text-slate-900">$499.00</span>
              </div>
            </div>
          </div>
        </div>

        <form id="props-form" method="post" action="/pmc/onboarding/properties" class="mt-6 space-y-4">

          <div class="space-y-2">
            {% for property in properties %}
              <label class="flex items-center justify-between gap-3 rounded-xl border border-slate-200 bg-white px-4 py-3">
                <div class="flex items-center gap-3">
                  <input
                    type="checkbox"
                    name="property_ids"
                    value="{{ property.id }}"
                    class="h-4 w-4 rounded border-slate-300 text-slate-900 focus:ring-slate-500"
                    {% if property.sandy_enabled %}checked{% endif %}
                  />
                  <div>
                    <div class="text-sm font-semibold text-slate-900">{{ property.property_name }}</div>
                    <div class="text-[12px] text-slate-500">
                      $9.99 / month if enabled
                    </div>
                  </div>
                </div>

                <span class="text-xs font-semibold text-slate-600">
                  Optional
                </span>
              </label>
            {% endfor %}
          </div>

          <div class="pt-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div class="text-xs text-slate-500">
              You can always adjust which properties are live in your dashboard.
            </div>

            <button
              id="continue-btn"
              type="submit"
              class="h-11 px-5 rounded-xl bg-slate-900 hover:bg-slate-800 text-white text-sm font-semibold"
            >
              Continue → Review & Pay
            </button>
          </div>
        </form>

        {% endif %}
      </div>
    </main>
  </div>

  <script>
    (function () {
      const MONTHLY_PRICE = 9.99;
      const ONE_TIME_FEE = 499.00;

      const form = document.getElementById("props-form");
      if (!form) return;

      const countEl = document.getElementById("selected-count");
      const monthlyEl = document.getElementById("monthly-total");
      const dueTodayEl = document.getElementById("due-today");

      function fmtMoney(n) {
        return n.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }

      function recompute() {
        const checked = form.querySelectorAll('input[type="checkbox"][name="property_ids"]:checked');
        const count = checked.length;
        const monthly = count * MONTHLY_PRICE;

        if (countEl) countEl.textContent = String(count);
        if (monthlyEl) monthlyEl.textContent = `$${fmtMoney(monthly)}/mo`;

        // Due today: only the $499 setup fee (subscription starts and renews monthly)
        if (dueTodayEl) dueTodayEl.textContent = `$${fmtMoney(ONE_TIME_FEE)}`;
      }

      form.addEventListener("change", (e) => {
        if (e.target && e.target.matches('input[type="checkbox"][name="property_ids"]')) {
          recompute();
        }
      });

      // initial
      recompute();
    })();
  </script>
</body>
</html>
