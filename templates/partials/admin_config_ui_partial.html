<div class="wrap">
    <input type="hidden" id="configFilePath" value="{{ file_path|e }}" />
    <div class="topbar">
      <div>
        <h1>Config Editor</h1>
        <div class="muted">
          Editing: <span class="kbd">{{ file_path }}</span>
          {% if scope_label %} · <span class="pill">{{ scope_label }}</span>{% endif %}
        </div>
      </div>

      <div class="status">
        <span id="dot" class="status-dot"></span>
        <span id="statusText" class="muted">Loaded.</span>
        <button class="btn" id="btnReload" type="button">Reload</button>

        {% if not is_defaults %}
          <button class="btn danger" id="btnResetAll" type="button">Reset to defaults</button>
        {% else %}
          <button class="btn" id="btnResetAll" type="button" disabled title="You are editing defaults already">
            Reset to defaults
          </button>
        {% endif %}

        <button class="btn primary" id="btnSave" type="button">Save</button>
      </div>
    </div>

    <div class="notice card">
      <div class="small">
        Changes auto-save after you stop typing for a moment. If you prefer manual save, use the <b>Save</b> button.
      </div>
    </div>

    <div class="split">
      <div class="card">
        <h2>Assistant</h2>
        <div class="grid">
          <div>
            <label>Name</label>
            <input id="assistant_name" type="text" placeholder="Sandy" />
          </div>
          <div>
            <label>Avatar URL</label>
            <input id="assistant_avatar_url" type="text" placeholder="/static/img/sandy.png" />
          </div>

          <div>
            <label>Tone</label>
            <select id="assistant_tone">
              <option value="luxury">Luxury</option>
              <option value="friendly">Friendly</option>
              <option value="playful">Playful</option>
              <option value="professional">Professional</option>
              <option value="casual">Casual</option>
            </select>
          </div>

          <div>
            <label>Formality</label>
            <select id="assistant_formality">
              <option value="polished">Polished</option>
              <option value="neutral">Neutral</option>
              <option value="casual">Casual</option>
            </select>
          </div>

          <div>
            <label>Verbosity</label>
            <select id="assistant_verbosity">
              <option value="short">Short</option>
              <option value="balanced">Balanced</option>
              <option value="detailed">Detailed</option>
            </select>
          </div>

          <div>
            <label>Emoji level</label>
            <select id="assistant_emoji_level">
              <option value="none">None</option>
              <option value="light">Light</option>
              <option value="moderate">Moderate</option>
              <option value="heavy">Heavy</option>
            </select>
          </div>

          <div style="grid-column:1 / -1;">
            <label>Style (short description used as instruction)</label>
            <input id="assistant_style" type="text" placeholder="Minimal, premium hotel concierge tone. Calm, professional, very short." />
          </div>

          <div style="grid-column:1 / -1;">
            <label>Extra instructions (optional)</label>
            <textarea id="assistant_extra_instructions" placeholder="Anything special for this property/team..."></textarea>
          </div>
        </div>

        <div class="hr"></div>

        <h2>Do / Don’t</h2>
        <div class="grid">
          <div>
            <label>Do (one per line)</label>
            <textarea id="assistant_do" placeholder="Use short bold headers&#10;Offer 1-2 top recommendations first"></textarea>
          </div>
          <div>
            <label>Don’t (one per line)</label>
            <textarea id="assistant_dont" placeholder="Don’t ramble&#10;Don’t use excessive emojis"></textarea>
          </div>
        </div>

        <div class="hr"></div>

        <h2>Voice templates</h2>
        <div class="grid">
          <div>
            <label>Welcome (with guest name)</label>
            <textarea id="voice_welcome_template"></textarea>
          </div>
          <div>
            <label>Welcome (no name)</label>
            <textarea id="voice_welcome_template_no_name"></textarea>
          </div>
          <div>
            <label>Offline message</label>
            <textarea id="voice_offline_message"></textarea>
          </div>
          <div>
            <label>Fallback message</label>
            <textarea id="voice_fallback_message"></textarea>
          </div>
          <div style="grid-column:1 / -1;">
            <label>Error message</label>
            <textarea id="voice_error_message"></textarea>
          </div>
        </div>

        <div class="hr"></div>

        <h2>Quick replies</h2>
        <div class="row">
          <input id="quickReplyInput" type="text" placeholder="Add a quick reply (e.g., WiFi)" style="flex:1; min-width: 260px;" />
          <button class="btn" id="btnAddQuickReply" type="button">Add</button>
        </div>

        <div class="list" id="quickRepliesList" style="margin-top:10px;"></div>
        <div class="muted small" style="margin-top:8px;">
          Drag to reorder. These are shown as suggested buttons to guests.
        </div>
      </div>

      <div>
        <div class="card">
          <h2>Live preview</h2>
          <div class="muted small">This is just a UI preview of how “Sandy” will sound.</div>
          <div class="preview" style="margin-top:10px;">
            <div class="bubble">
              <strong id="pvName">Sandy</strong> <span class="muted">(assistant)</span><br/>
              <span id="pvWelcome">Hi there! I’m Sandy, your stay assistant for Casa Sea Esta.</span>
            </div>
            <div class="bubble">
              <strong>Guest</strong><br/>
              Can you share the WiFi and parking info?
            </div>
            <div class="bubble">
              <strong id="pvName2">Sandy</strong><br/>
              <span id="pvReply">
                <b>WiFi</b><br/>
                Network: …<br/>
                Password: …<br/><br/>
                <b>Parking</b><br/>
                Here are the best options…
              </span>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:12px;">
          <h2>Advanced</h2>
          <div class="muted small">If needed, you can edit raw JSON here. Prefer the form above.</div>
          <textarea id="rawJson" style="min-height: 260px; margin-top:10px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas; font-size:12px;"></textarea>
          <div class="row" style="margin-top:10px;">
            <button class="btn" id="btnApplyRaw" type="button">Apply raw JSON → form</button>
            <button class="btn" id="btnSyncRaw" type="button">Sync form → raw JSON</button>
          </div>
        </div>
      </div>
    </div>

<script id="config-ui-bootstrap" type="application/json">
{
  "file_path": {{ file_path|tojson }},
  "is_defaults": {{ (is_defaults or False)|tojson }},
  "config_json": {{ config_json|tojson }},
  "scope_label": {{ (scope_label or "")|tojson }},
  "property_name": {{ (property_name or "")|tojson }}
}
</script>
  </div>

